#!/usr/bin/perl
use strict;
$|++;

my $VERSION = '0.01';

#----------------------------------------------------------------------------

=head1 NAME

cpanreps-update - script to update the CPAN Testers Reports website.

=head1 SYNOPSIS

  perl cpanreps-update

=head1 DESCRIPTION

Using an update file, will update the specific distribution and author pages
for the website.

=cut

# -------------------------------------
# Library Modules

use FindBin;
use lib ("$FindBin::Bin/../lib", "../lib");
use CPAN::WWW::Testers;
use Getopt::ArgvFile default=>1;
use Getopt::Long;
use File::Path;

# -------------------------------------
# Variables

my (%options);

# -------------------------------------
# Program

##### INITIALISE #####

init_options();

##### MAIN #####

my $t = CPAN::WWW::Testers->new();

my $directory = $options{directory} || 'www';
mkpath($directory);
die $!  unless(-d $directory);
$t->directory($directory);

if($options{update})  { $t->updates($options{update});   }
if($options{testers}) { $t->database($options{testers}); }
if($options{list} && -f $options{list})	{ $t->list($options{list}); }

$t->update;

# -------------------------------------
# Subroutines

sub init_options {
    GetOptions( \%options,
        'directory|d=s',
        'testers|t=s',
        'list|l=s',
        'update|u=s',
        'help|h',
        'version|V'
    );

    _help(1) if($options{help});
    _help(0) if($options{version});
}

sub _help {
    my $full = shift;

    if($full) {
        print <<HERE;

Usage: $0 \\
         [-d directory] [-t database] [-l file] [-u file] [-h] [-V]

  -d directory  directory location of build files
  -t database   local database file
  -l file       local 'find-ls.gz' file
  -u file       update file
  -h            this help screen
  -V            program version

HERE

    }

    print "$0 v$VERSION\n\n";
    exit(0);
}

__END__

=head1 BUGS, PATCHES & FIXES

There are no known bugs at the time of this release. However, if you spot a
bug or are experiencing difficulties, that is not explained within the POD
documentation, please send bug reports and patches to the RT Queue (see below).

Fixes are dependant upon their severity and my availablity. Should a fix not
be forthcoming, please feel free to (politely) remind me.

RT: http://rt.cpan.org/Public/Dist/Display.html?Name=CPAN-WWW-Testers

=head1 SEE ALSO

L<CPAN::WWW::Testers::Generator>
L<CPAN::Testers::WWW::Statistics>

F<http://www.cpantesters.org/>,
F<http://stats.cpantesters.org/>

=head1 AUTHOR

  Barbie <barbie@cpan.org>

=head1 COPYRIGHT AND LICENSE

  Copyright (C) 2008      Barbie <barbie@cpan.org>

  This module is free software; you can redistribute it and/or
  modify it under the same terms as Perl itself.

=cut
